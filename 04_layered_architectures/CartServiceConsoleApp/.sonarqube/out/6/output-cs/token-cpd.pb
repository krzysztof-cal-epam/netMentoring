ž
[C:\netMentoring\04_layered_architectures\CartServiceConsoleApp\CartServiceWebApi\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
	AddScoped 
< 
ICartService '
,' (
CartService) 4
>4 5
(5 6
)6 7
;7 8
builder 
. 
Services 
. 
	AddScoped 
< 
ICartRepository *
,* +
CartRepository, :
>: ;
(; <
)< =
;= >
builder 
. 
Services 
. 
	AddScoped 
< 
ICartDatabase (
<( )
Cart) -
>- .
>. /
(/ 0
provider0 8
=>9 ;
{ 
var 
configuration 
= 
provider  
.  !
GetRequiredService! 3
<3 4
IConfiguration4 B
>B C
(C D
)D E
;E F
var 

connection 
= 
configuration "
[" #
$str# 8
]8 9
;9 :
return 

new 
LiteDbCartDatabase !
(! "

connection" ,
), -
;- .
} 
) 
; 
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
app 
. 
Environment 
. 
IsDevelopment !
(! "
)" #
)# $
{ 
app 
. 

UseSwagger 
( 
) 
; 
app   
.   
UseSwaggerUI   
(   
)   
;   
}!! 
app## 
.## 
UseHttpsRedirection## 
(## 
)## 
;## 
app%% 
.%% 
UseAuthorization%% 
(%% 
)%% 
;%% 
app'' 
.'' 
MapControllers'' 
('' 
)'' 
;'' 
app)) 
.)) 
Run)) 
()) 
))) 	
;))	 
½&
nC:\netMentoring\04_layered_architectures\CartServiceConsoleApp\CartServiceWebApi\Controllers\CartController.cs
	namespace 	
CartServiceWebApi
 
. 
Controllers '
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public		 

class		 
CartController		 
:		  !
ControllerBase		" 0
{

 
private 
readonly 
ICartService %
_cartService& 2
;2 3
public 
CartController 
( 
ICartService *
cartService+ 6
)6 7
{ 	
_cartService 
= 
cartService &
;& '
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
ActionResult 
< 
List  
<  !
CartItem! )
>) *
>* +
GetCartItems, 8
(8 9
Guid9 =
cartId> D
)D E
{ 	
var 
	cartItems 
= 
_cartService (
.( )
GetItems) 1
(1 2
cartId2 8
)8 9
;9 :
if 
( 
	cartItems 
== 
null !
||" $
	cartItems% .
.. /
Count/ 4
==5 7
$num8 9
)9 :
{ 
return 
NotFound 
(  
$"  "
$str" /
{/ 0
cartId0 6
}6 7
$str7 N
"N O
)O P
;P Q
} 
return 
Ok 
( 
	cartItems 
)  
;  !
} 	
[   	
HttpPost  	 
(   
$str   "
)  " #
]  # $
public!! 
ActionResult!! 
AddItemToCart!! )
(!!) *
Guid!!* .
cartId!!/ 5
,!!5 6
[!!7 8
FromBody!!8 @
]!!@ A
CartItem!!B J
cartItem!!K S
)!!S T
{"" 	
if## 
(## 
cartItem## 
==## 
null##  
)##  !
{$$ 
return%% 

BadRequest%% !
(%%! "
$str%%" <
)%%< =
;%%= >
}&& 
_cartService(( 
.(( 
AddItem((  
(((  !
cartId((! '
,((' (
cartItem(() 1
)((1 2
;((2 3
return)) 
Ok)) 
()) 
$")) 
$str)) +
{))+ ,
cartId)), 2
}))2 3
$str))3 4
"))4 5
)))5 6
;))6 7
}** 	
[-- 	

HttpDelete--	 
(-- 
$str-- -
)--- .
]--. /
public.. 
ActionResult.. 
RemoveItemFromCart.. .
(... /
Guid../ 3
cartId..4 :
,..: ;
int..< ?
itemId..@ F
)..F G
{// 	
var00 
cart00 
=00 
_cartService00 #
.00# $
GetItems00$ ,
(00, -
cartId00- 3
)003 4
;004 5
if11 
(11 
cart11 
==11 
null11 
||11 
cart11  $
.11$ %
Count11% *
==11+ -
$num11. /
)11/ 0
{22 
return33 
NotFound33 
(33  
$"33  "
$str33" /
{33/ 0
cartId330 6
}336 7
$str337 N
"33N O
)33O P
;33P Q
}44 
_cartService66 
.66 

RemoveItem66 #
(66# $
cartId66$ *
,66* +
itemId66, 2
)662 3
;663 4
return77 
Ok77 
(77 
$"77 
$str77 
{77 
itemId77 $
}77$ %
$str77% 8
{778 9
cartId779 ?
}77? @
$str77@ A
"77A B
)77B C
;77C D
}88 	
[:: 	
HttpGet::	 
(:: 
$str:: 
):: 
]:: 
public;; 
ActionResult;; 
<;; 
IEnumerable;; '
<;;' (
Cart;;( ,
>;;, -
>;;- .
GetAllCarts;;/ :
(;;: ;
);;; <
{<< 	
var== 
carts== 
=== 
_cartService== $
.==$ %
GetAllCarts==% 0
(==0 1
)==1 2
;==2 3
return>> 
Ok>> 
(>> 
carts>> 
)>> 
;>> 
}?? 	
}@@ 
}AA 